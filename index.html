<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sheet Dashboard</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f4f4f4;
}

.filters {
  display: flex;
  gap: 30px;
  margin-bottom: 20px;
}

.filter-box {
  background: white;
  padding: 10px;
  border: 1px solid #ccc;
  max-height: 180px;
  overflow-y: auto;
}

.filter-box h4 {
  margin: 0 0 10px 0;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
}

th {
  background: #4CAF50;
  color: white;
}
</style>
</head>

<body>

<h2>Plant Generation Dashboard</h2>

<!-- ðŸ”¹ FILTERS -->
<div class="filters">

  <!-- Plant Filter -->
  <div class="filter-box">
    <h4>Plant Name</h4>
    <div id="plantFilter"></div>
  </div>

  <!-- Month Filter -->
  <div class="filter-box">
    <h4>Month</h4>
    <div id="monthFilter"></div>
  </div>

</div>

<table id="table">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/1Y3cr91xEEQj86B9hXMYdpp6UU1a33-vlrFcWKkLRujg/gviz/tq?tqx=out:csv&sheet=Sheet1";

const MAX_COLUMNS = 19;

let allData = [];
let selectedPlants = new Set();
let selectedMonths = new Set();

fetch(sheetURL)
.then(res => res.text())
.then(csv => {
  const rows = csv.trim().split("\n");
  const headers = rows[0].split(",").slice(0, MAX_COLUMNS);

  // HEADER
  document.querySelector("#table thead").innerHTML =
    `<tr>${headers.map(h => `<th>${h.replace(/"/g,"")}</th>`).join("")}</tr>`;

  // DATA
  rows.slice(1).forEach(row => {
    const cols = row.split(",").slice(0, MAX_COLUMNS).map(c => c.replace(/"/g,""));
    allData.push(cols);
  });

  buildFilters();
  renderTable();
});

// ðŸ”¹ BUILD FILTER CHECKBOXES
function buildFilters() {

  const plantIndex = 0; // ðŸ”´ Plant Name column
  const monthIndex = 2; // ðŸ”´ Month column

  const plants = [...new Set(allData.map(r => r[plantIndex]))];
  const months = [...new Set(allData.map(r => r[monthIndex]))];

  const plantDiv = document.getElementById("plantFilter");
  plants.forEach(p => {
    plantDiv.innerHTML += `
      <label>
        <input type="checkbox" checked onchange="togglePlant('${p}', this.checked)">
        ${p}
      </label><br>
    `;
    selectedPlants.add(p);
  });

  const monthDiv = document.getElementById("monthFilter");
  months.forEach(m => {
    monthDiv.innerHTML += `
      <label>
        <input type="checkbox" checked onchange="toggleMonth('${m}', this.checked)">
        ${m}
      </label><br>
    `;
    selectedMonths.add(m);
  });
}

// ðŸ”¹ TOGGLE FUNCTIONS
function togglePlant(value, checked) {
  checked ? selectedPlants.add(value) : selectedPlants.delete(value);
  renderTable();
}

function toggleMonth(value, checked) {
  checked ? selectedMonths.add(value) : selectedMonths.delete(value);
  renderTable();
}

// ðŸ”¹ RENDER TABLE
function renderTable() {
  const tbody = document.querySelector("#table tbody");
  tbody.innerHTML = "";

  const plantIndex = 0;
  const monthIndex = 2;

  allData.forEach(row => {
    if (
      selectedPlants.has(row[plantIndex]) &&
      selectedMonths.has(row[monthIndex])
    ) {
      tbody.innerHTML += `
        <tr>${row.map(col => `<td>${col}</td>`).join("")}</tr>
      `;
    }
  });
}
</script>

</body>
</html>
